<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mecanizado Fácil</title>
    <link rel="manifest" href="/manifest.json"> <!-- Link to your manifest file -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
    <div class="container">
        <div style="margin: 10px 0;">
    <a href="index.html" style="display: inline-flex; align-items: center; text-decoration: none; color: var(--accent-primary); font-weight: 500; font-family: 'Roboto', sans-serif;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
            <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
        </svg>
        Volver al Inicio
    </a>
</div><h1>Mecanizado Fácil</h1>
        <button id="cacheButton" onclick="cacheSiteOffline()">Guardar para uso sin conexión</button>
        <button id="installButton">Instalar como App</button>
        <div id="cacheStatus"></div>
        <ul>
            <li><a href="metalesindustriales.html">Guía de Referencia para Metales en la Industria</a></li>
            <li><a href="conversiones.html">Herramienta completa de conversión de unidades técnicas</a></li>
            <li><a href="cilindrosyconos.html">Calculadora de Desarrollo de Cilindros y Conos</a></li>
            <li><a href="avances.html">Calculadora de Avances Para Fresadoras y tornos</a></li>
            <li><a href="roscas.html">Consultor de Roscas para Taller</a></li>
            <li><a href="pesos.html">Calculadora de Peso de Materiales</a></li>
            <li><a href="agujerosypcd.html">Herramienta de Disposición de Agujeros en PCD</a></li>
            <li><a href="cabezaldivisor.html">Calculadora para Cabezal Divisor</a></li>
            <li><a href="tolerancias.html">Calculadora de Tolerancias ISO</a></li>
            <li><a href="inclinacabezal.html">Calculadora de Inclinación de Cabezal</a></li>
            <li><a href="engranajes.html">Calculadora Avanzada de Engranajes</a></li>
            <li><a href="chavetas.html">Calculadora de Chaveteros</a></li>
            <li><a href="triangulos.html">Calculadora de Triángulos</a></li>
            <li><a href="calcientifica.html">Calculadora Científica Avanzada</a></li>
            <li><a href="guiacnc.html">Guía de Códigos G y M Comunes para CNC</a></li>
            <li><a href="codigog71.html">Generador de Código G71 y Guía para Torno CNC</a></li>
            <li><a href="g76roscado.html">Calculadora de Código G G76 (Fanuc) y Guía</a></li>
            <li><a href="ciclotaladro.html">Generador de Ciclos de Taladrado G81/G83</a></li>
            <li><a href="perfiles.html">Programador de Perfiles para Torno CNC</a></li>
            <li><a href="editorcnc.html">Editor CNC</a></li>
        </ul>
    </div>
    <script>
        let deferredPrompt; // Variable para almacenar el evento de instalación

        // Escuchar el evento beforeinstallprompt
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevenir que la mini-barra de información aparezca automáticamente
            e.preventDefault();
            // Almacenar el evento para que pueda ser activado más tarde.
            deferredPrompt = e;
            // Mostrar el botón de instalación
            const installButton = document.getElementById('installButton');
            if (installButton) {
                installButton.style.display = 'block';
            }
            console.log('\'beforeinstallprompt\' event was fired.');
        });

        // Manejar el clic en el botón de instalación
        const installButton = document.getElementById('installButton');
        if (installButton) {
            installButton.addEventListener('click', async () => {
                // Ocultar el botón de instalación
                installButton.style.display = 'none';
                // Mostrar el prompt de instalación
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    // Esperar a que el usuario responda al prompt
                    const { outcome } = await deferredPrompt.userChoice;
                    // Opcionalmente, enviar analíticas para rastrear si el usuario aceptó el prompt
                    console.log(`User response to the install prompt: ${outcome}`);
                    // Ya usamos el prompt, no se puede usar de nuevo; lo limpiamos
                    deferredPrompt = null;
                }
            });
        }

        // Escuchar el evento appinstalled (opcional, para rastrear)
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            const installButton = document.getElementById('installButton');
             if (installButton) {
                installButton.style.display = 'none'; // Ocultar botón después de la instalación exitosa
             }
        });

        // --- Existing cacheSiteOffline function ---
        // (Keep the existing cacheSiteOffline function here)
        // Make sure it's inside the same script block or accessible.
        // The diff below will show the function as it was, just adding the PWA logic around it.

        // Existing cacheSiteOffline function:
        function cacheSiteOffline() {
            const cacheButton = document.getElementById('cacheButton');
            const cacheStatus = document.getElementById('cacheStatus');

            if ('serviceWorker' in navigator) {
                cacheStatus.textContent = 'Guardando sitio en caché... Por favor, espera.';
                cacheStatus.style.backgroundColor = 'rgba(255, 152, 0, 0.8)'; /* Orange background for status */
                cacheStatus.style.color = '#000'; /* Dark text for orange background */
                cacheButton.disabled = true;

                navigator.serviceWorker.register('./sw.js') // Asegúrate que la ruta a sw.js sea correcta
                    .then(registration => {
                        console.log('ServiceWorker registrado con éxito, scope:', registration.scope);

                        if (registration.installing) {
                            registration.installing.addEventListener('statechange', () => {
                                if (registration.active) {
                                    cacheStatus.textContent = '¡Sitio guardado en caché! Ahora puedes usarlo sin conexión.'; // Keep original success message
                                    cacheStatus.style.color = 'green';
                                    cacheButton.textContent = 'Sitio guardado';
                                }
                            });
                        } else if (registration.active) {
                             cacheStatus.textContent = 'El sitio ya está guardado en caché y listo para uso sin conexión.';
                             cacheStatus.style.backgroundColor = 'rgba(76, 175, 80, 0.8)'; /* Green background */
                             cacheButton.textContent = 'Sitio guardado'; // Keep original success text
                        } else { // Si no está instalando ni activo, pero el registro fue exitoso, esperamos el cambio de estado
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                     if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        cacheStatus.textContent = '¡Sitio guardado en caché! Ahora puedes usarlo sin conexión.';                                        
                                        cacheStatus.style.backgroundColor = 'rgba(76, 175, 80, 0.8)'; /* Green background */
                                        cacheButton.textContent = 'Sitio guardado';
                                     }
                                });
                            });
                        }
                    })
                    .catch(error => {
                        console.log('Fallo en el registro del ServiceWorker:', error);
                        cacheStatus.textContent = 'Error al guardar el sitio en caché. Inténtalo de nuevo.';
                        cacheStatus.style.backgroundColor = 'rgba(244, 67, 54, 0.8)'; /* Red background */
                        cacheButton.disabled = false;
                    });
            } else {
                cacheStatus.textContent = 'Tu navegador no soporta la funcionalidad para guardar offline.';
                cacheStatus.style.color = 'red';
                cacheButton.style.display = 'none';
            }
        }
    </script>
    </div>
</body>
</html>

