<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calculadora Científica Avanzada - Mecanizado Facil</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
<link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
    <div class="calc-container">
        <div class="calc-title">Calculadora Científica Mecanizado Facil</div>
        <div id="display" class="display">0</div>
        <div class="buttons">
            <button onclick="input('7')">7</button>
            <button onclick="input('8')">8</button>
            <button onclick="input('9')">9</button>
            <button class="operator" onclick="input('/')">÷</button>
            <button class="operator" onclick="input('^')">xʸ</button>
            <button class="operator" onclick="input('sqrt(')">√</button>

            <button onclick="input('4')">4</button>
            <button onclick="input('5')">5</button>
            <button onclick="input('6')">6</button>
            <button class="operator" onclick="input('*')">×</button>
            <button class="operator" onclick="input('(')">(</button>
            <button class="operator" onclick="input(')')">)</button>

            <button onclick="input('1')">1</button>
            <button onclick="input('2')">2</button>
            <button onclick="input('3')">3</button>
            <button class="operator" onclick="input('-')">−</button>
            <button class="operator" onclick="input('pi')">π</button>
            <button class="operator" onclick="input('e')">e</button>

            <button onclick="input('0')">0</button>
            <button onclick="input('.')">.</button>
            <button class="clear" onclick="clearDisplay()">C</button>
            <button class="operator" onclick="input('+')">+</button>
            <button class="operator" onclick="input('Ans')">Ans</button>
            <button class="operator" onclick="backspace()">←</button>

            <button class="operator" onclick="input('sin(')">sin</button>
            <button class="operator" onclick="input('cos(')">cos</button>
            <button class="operator" onclick="input('tan(')">tan</button>
            <button class="operator" onclick="input('log(')">log</button>
            <button class="operator" onclick="input('ln(')">ln</button>
            <button class="operator" onclick="input('abs(')">|x|</button>

            <button class="operator" onclick="input('exp(')">exp</button>
            <button class="operator" onclick="input('!')">n!</button>
            <button class="operator" onclick="input('deg')">°</button>
            <button class="operator" onclick="input('rad')">rad</button>
            <button class="operator" onclick="input('mod')">mod</button>
            <button class="equal" onclick="calculate()" style="grid-column: span 2;">=</button>
        </div>
        <div class="footer">
            Para talleres metalmecánicos y uso general
        </div>
    </div>
    <script>
        let display = document.getElementById('display');
        let expression = "";
        let lastAnswer = "0";
        let angleMode = "DEG"; // DEG o RAD

        function input(val) {
            if (val === 'pi') val = 'π';
            if (val === 'e') val = 'ℯ';
            if (val === 'Ans') val = lastAnswer;
            if (val === 'deg') angleMode = "DEG";
            if (val === 'rad') angleMode = "RAD";
            if (val === 'mod') val = '%';
            if (val === 'sqrt(') val = '√(';
            if (val === '^') val = '^';
            if (val === '!') val = '!';
            if (val === 'exp(') val = 'exp(';
            if (val === '|x|') val = 'abs(';
            if (val === 'ln(') val = 'ln(';
            if (val === 'log(') val = 'log(';
            if (val === 'sin(') val = 'sin(';
            if (val === 'cos(') val = 'cos(';
            if (val === 'tan(') val = 'tan(';
            if (val === 'abs(') val = 'abs(';
            if (val === '√(') val = '√(';
            if (val === 'exp(') val = 'exp(';
            if (val === 'mod') val = '%';
            if (val === '°') angleMode = "DEG";
            if (val === 'rad') angleMode = "RAD";
            if (val === 'mod') val = '%';
            if (val === 'Ans') val = lastAnswer;
            if (val === 'deg' || val === 'rad') {
                display.textContent = (angleMode === "DEG" ? "Modo: Grados" : "Modo: Radianes");
                setTimeout(() => display.textContent = expression || "0", 800);
                return;
            }
            expression += val;
            display.textContent = expression;
        }

        function clearDisplay() {
            expression = "";
            display.textContent = "0";
        }

        function backspace() {
            expression = expression.slice(0, -1);
            display.textContent = expression || "0";
        }

        function factorial(n) {
            if (n < 0) return NaN;
            if (n === 0 || n === 1) return 1;
            let res = 1;
            for (let i = 2; i <= n; i++) res *= i;
            return res;
        }

        function calculate() {
            try {
                let expr = expression
                    .replace(/π/g, "Math.PI")
                    .replace(/ℯ/g, "Math.E")
                    .replace(/Ans/g, lastAnswer)
                    .replace(/√\(/g, "Math.sqrt(")
                    .replace(/sin\(/g, (angleMode === "DEG" ? "degSin(" : "Math.sin("))
                    .replace(/cos\(/g, (angleMode === "DEG" ? "degCos(" : "Math.cos("))
                    .replace(/tan\(/g, (angleMode === "DEG" ? "degTan(" : "Math.tan("))
                    .replace(/log\(/g, "Math.log10(")
                    .replace(/ln\(/g, "Math.log(")
                    .replace(/abs\(/g, "Math.abs(")
                    .replace(/exp\(/g, "Math.exp(")
                    .replace(/\^/g, "**")
                    .replace(/%/g, "/100")
                    .replace(/([0-9\.]+)!/g, "fact($1)");

                // Funciones trigonométricas en grados
                function degSin(x) { return Math.sin(x * Math.PI / 180); }
                function degCos(x) { return Math.cos(x * Math.PI / 180); }
                function degTan(x) { return Math.tan(x * Math.PI / 180); }
                function fact(n) { return factorial(Number(n)); }

                // eslint-disable-next-line no-new-func
                let result = Function("degSin","degCos","degTan","fact","return " + expr)
                    (degSin, degCos, degTan, fact);

                if (typeof result === "number" && isFinite(result)) {
                    display.textContent = result;
                    lastAnswer = result;
                    expression = "";
                } else {
                    display.textContent = "Error";
                    expression = "";
                }
            } catch {
                display.textContent = "Error";
                expression = "";
            }
        }
    </script>
    </div>
</body>
</html>